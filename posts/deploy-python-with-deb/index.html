<!doctype html><html lang=en-gb><head><title>Deploy Python With Deb // Lllama's blog</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.152.2"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="John Doe"><meta name=description content><link rel=stylesheet href=/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploy Python With Deb"><meta name=twitter:description content="One of the worst parts about working with python is how to share your code, or deploy it on another machine. If you’re following preferred practices, then you’re probably developing using a virtual environment. But that means you need a way to have the same environment where your app is going to run. Either your users need to go through several steps to create a virtual environment and then install your app and its dependencies to it, or you need to ship the environment along with your app. Or you start having to use containers."><meta property="og:url" content="https://lllama.github.io/posts/deploy-python-with-deb/"><meta property="og:site_name" content="Lllama's blog"><meta property="og:title" content="Deploy Python With Deb"><meta property="og:description" content="One of the worst parts about working with python is how to share your code, or deploy it on another machine. If you’re following preferred practices, then you’re probably developing using a virtual environment. But that means you need a way to have the same environment where your app is going to run. Either your users need to go through several steps to create a virtual environment and then install your app and its dependencies to it, or you need to ship the environment along with your app. Or you start having to use containers."><meta property="og:locale" content="en_gb"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-19T12:28:33+01:00"><meta property="article:modified_time" content="2022-07-19T12:28:33+01:00"></head><body><header class=app-header><a href=/><img class=app-header-avatar src=/avatar.jpg alt="John Doe"></a>
<span class=app-header-title>Lllama's blog</span><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Deploy Python With Deb</h1><div class=post-meta><div><svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Jul 19, 2022</div><div><svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 min read</div></div></header><div class=post-content><p>One of the worst parts about working with python is how to share your code, or
deploy it on another machine. If you&rsquo;re following preferred practices, then
you&rsquo;re probably developing using a virtual environment. But that means you need
a way to have the same environment where your app is going to run. Either your
users need to go through several steps to create a virtual environment and then
install your app and its dependencies to it, or you need to ship the
environment along with your app. Or you start having to use containers.</p><p>For most python web apps, there is little or no advantage to kubernetes (or
Docker Swarm). You want to run your app using something like gunicorn, uvicorn,
hypercorn, and possibly have these running behind nginx or apache. You probably also want a database and some other services to be running as well. Your deployment environment may well be a single VM that you&rsquo;ve created just for this purpose, so having to get kubernetes up and running seems redundant.</p><p>Assuming you&rsquo;re running something like Ubuntu, or CentOS, then why can&rsquo;t you
use your package manager to install your app for you? Inspired by <a href=https://www.nylas.com/blog/packaging-deploying-python/>this blog
post by nylas</a>, I
decided to have a look at whether this would be possible for an internal web
app that I&rsquo;ve developed.</p><h1 id=the-application-to-deploy>The application to deploy</h1><p>The app has a simple web interface that talks to a DB,
and a couple more system services that need to be running as well. The DB is
postgresql, as that&rsquo;s my DB of choice.</p><p>For the web app, I&rsquo;m using <a href=https://sanic.dev/>Sanic</a>. The framework is very
developer friendly, it supports async for handling large amounts of traffic,
and it comes with its own high performance web server (including <a href=https://github.com/sanic-org/sanic/releases/tag/v22.6.0>experimental
http/3 support</a>. While
the performance of the web server is a good feature, it&rsquo;s the fact that it
simplifies deployment that really helps.</p><h1 id=the-deployment-plan>The deployment plan</h1><p>The aim is to create a <code>deb</code> file that will contain the app, its virtual
environment, and all other assets. The <code>deb</code> will specify other packages the
app depends on (e.g. postgresql). Installing it will also install appropriate
<code>systemd</code> units that launch the app and allow it to be controlled with
<code>systemctl</code>. Logs will ship to <code>journald</code>. We will also create new users for
the app to run under, and make sure that we&rsquo;re running with least privileges.
Installing the app will also create the database it will use in postgres, and
create all necessary tables and relations. Future upgrades will allow us to run
schema migrations, either as our own SQL, or using our own python script.</p></div><div class=post-footer></div></article></main></body></html>